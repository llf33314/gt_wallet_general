webpackJsonp([13],{"8J4s":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={data:function(){return{tableData3:[],multipleSelection:[],filters:[{value:"",text:""}],form:{current:1,wmemberId:7,size:10,msgType:""},page:{total:1},readstate:0,selectIds:[]}},mounted:function(){this.form.wmemberId=window.sessionStorage.walletId,this.getPage(),this.getMsgTypeResult(),this.getReadState()},watch:{"form.msgType":function(){var e=this;this.form.current=1,setTimeout(function(){e.getPage()},100)}},methods:{getReadState:function(){var e=this;$.ajax({url:this.DFPAYDOMAIN+"/walletMessage/79B4DE7C/getReadState",type:"POST",dataType:"JSON",data:{wMemberId:window.sessionStorage.walletId},success:function(t){console.log(t,"获取未读记录数"),0==t.code?e.readstate=t.data:e.$message.error(t.msg)}})},filterChange:function(){this.form.current=1,this.getPage()},getPage:function(){var e=this;$.ajax({url:this.DFPAYDOMAIN+"/walletMessage/79B4DE7C/getPage",type:"POST",dataType:"JSON",data:this.form,success:function(t){console.log(t,"分页查询list"),0==t.code?(e.tableData3=t.data.records,e.page.total=t.data.total):(e.$message.error(t.msg),e.tableData3=[])}})},getMsgTypeResult:function(){var e=this;$.ajax({url:this.DFPAYDOMAIN+"/walletMessage/79B4DE7C/getMsgTypeResult",type:"POST",dataType:"JSON",success:function(t){if(console.log(t,"获取消息类型"),0==t.code){var a=t.data,s=[];a.forEach(function(e){s.push({text:e.msgTypeDesc,value:e.msgType})}),e.filters=a}else e.$message.error(t.msg)}})},handleCurrentChange:function(e){this.form.current=e,this.getPage()},filterTag:function(e,t){this.form.msgType=e},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.selectIds=e,console.log(e,56)},upstate:function(){var e=this,t=[];this.selectIds.forEach(function(e){t.push(e.id)}),0==t.length?this.$message.error("请选择消息"):$.ajax({url:this.DFPAYDOMAIN+"/walletMessage/79B4DE7C/upstate",type:"POST",dataType:"JSON",data:{listStr:window.JSON.stringify(t)},success:function(t){console.log(t,"已读"),0==t.code?(e.form.current=1,e.$message({message:t.msg,type:"success"}),e.getPage(),e.getReadState()):e.$message.error(t.msg)}})}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wallet-company-news"},[a("span",{staticClass:"tips",domProps:{textContent:e._s(e.readstate)}},[e._v("12")]),e._v(" "),a("div",{staticStyle:{"padding-bottom":"20px"}},[a("el-select",{attrs:{clearable:"",placeholder:"请选择消息类型"},model:{value:e.form.msgType,callback:function(t){e.$set(e.form,"msgType",t)},expression:"form.msgType"}},e._l(e.filters,function(e){return a("el-option",{key:e.msgType,attrs:{label:e.msgTypeDesc,value:e.msgType}})}))],1),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData3},on:{"selection-change":e.handleSelectionChange,"filter-change":e.filterChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"ctime",label:"日期",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{domProps:{textContent:e._s(e.DateFormat(t.row.ctime,"yyyy-MM-dd hh:mm"))}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"descContent",label:"内容"}}),e._v(" "),a("el-table-column",{attrs:{prop:"state ",label:"状态",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.state?a("span",[e._v("未读")]):e._e(),e._v(" "),1==t.row.state?a("span",[e._v("已读")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"state ",label:"消息类型",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"primary"}},[e._v(e._s(t.row.msgTypeDesc))])]}}])})],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-button",{attrs:{size:"small"},on:{click:function(t){e.toggleSelection(e.tableData3)}}},[e._v("全选")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.upstate}},[e._v("标记已读")]),e._v(" "),a("el-pagination",{staticStyle:{float:"right"},attrs:{"current-page":e.form.current,"page-size":10,layout:"prev, pager, next, jumper",total:e.page.total},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.form,"current",t)}}})],1)],1)},staticRenderFns:[]},n=a("oO+S")(s,l,!1,function(e){a("I33L")},null,null);t.default=n.exports},I33L:function(e,t){}});